{
    "curriculum_schema_name": "DynamicForagingCurriculum",
    "curriculum_schema_version": "1.0",
    "curriculum_name": "Coupled Baiting",
    "curriculum_version": "2.3",
    "curriculum_description": "2024-08-16 max_len = 75 mins; decrease finished trial criterion",
    "parameters": {
        "Stage 1 w/warmup": {
            "training_stage": "Stage 1 w/warmup",
            "task": "Coupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Warmup, followed by Phase B in Han's slides (block = [10, 20, 5], p_sum = 0.8, p_ratio = [1:0])",
            "BaseRewardSum": 0.8,
            "RewardFamily": 3,
            "RewardPairsN": 1,
            "UncoupledReward": "",
            "Randomness": "Exponential",
            "BlockMin": 10,
            "BlockMax": 20,
            "BlockBeta": 5,
            "BlockMinReward": 0,
            "DelayMin": 0.1,
            "DelayMax": 0.1,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": true,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 3,
            "Ignored": 3,
            "ITIMin": 1.0,
            "ITIMax": 7.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 5.0,
            "RewardConsumeTime": 1.0,
            "StopIgnores": 20000,
            "AdvancedBlockAuto": "now",
            "SwitchThr": 0.5,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 75,
            "RightValue_volume": 4.0,
            "LeftValue_volume": 4.0,
            "warmup": "on",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        },
        "Stage 1": {
            "training_stage": "Stage 1",
            "task": "Coupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Phase B in Han's slides (block = [10, 20, 5], p_sum = 0.8, p_ratio = [1:0])",
            "BaseRewardSum": 0.8,
            "RewardFamily": 3,
            "RewardPairsN": 1,
            "UncoupledReward": "",
            "Randomness": "Exponential",
            "BlockMin": 10,
            "BlockMax": 20,
            "BlockBeta": 5,
            "BlockMinReward": 0,
            "DelayMin": 0.1,
            "DelayMax": 0.1,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": true,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 5,
            "Ignored": 5,
            "ITIMin": 1.0,
            "ITIMax": 7.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 5.0,
            "RewardConsumeTime": 1.0,
            "StopIgnores": 20000,
            "AdvancedBlockAuto": "now",
            "SwitchThr": 0.5,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 75,
            "RightValue_volume": 2.0,
            "LeftValue_volume": 2.0,
            "warmup": "off",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        },
        "Stage 2": {
            "training_stage": "Stage 2",
            "task": "Coupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Phase C in Han's slides (block = [10, 40, 10], p_sum = 0.6, p_ratio = [8:1])",
            "BaseRewardSum": 0.6,
            "RewardFamily": 1,
            "RewardPairsN": 1,
            "UncoupledReward": "",
            "Randomness": "Exponential",
            "BlockMin": 10,
            "BlockMax": 40,
            "BlockBeta": 10,
            "BlockMinReward": 0,
            "DelayMin": 0.3,
            "DelayMax": 0.3,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": true,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 7,
            "Ignored": 7,
            "ITIMin": 1.0,
            "ITIMax": 10.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 3.0,
            "RewardConsumeTime": 1.0,
            "StopIgnores": 25,
            "AdvancedBlockAuto": "now",
            "SwitchThr": 0.6,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 75,
            "RightValue_volume": 2.0,
            "LeftValue_volume": 2.0,
            "warmup": "off",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        },
        "Stage 3": {
            "training_stage": "Stage 3",
            "task": "Coupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Phase D in Han's slides (block = [10, 40, 10], p_sum = 0.45, p_ratio = [8:1])",
            "BaseRewardSum": 0.45,
            "RewardFamily": 1,
            "RewardPairsN": 1,
            "UncoupledReward": "",
            "Randomness": "Exponential",
            "BlockMin": 20,
            "BlockMax": 60,
            "BlockBeta": 20,
            "BlockMinReward": 0,
            "DelayMin": 0.5,
            "DelayMax": 0.5,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": true,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 10,
            "Ignored": 10,
            "ITIMin": 1.0,
            "ITIMax": 15.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 2.0,
            "RewardConsumeTime": 1.0,
            "StopIgnores": 25,
            "AdvancedBlockAuto": "now",
            "SwitchThr": 0.6,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 75,
            "RightValue_volume": 2.0,
            "LeftValue_volume": 2.0,
            "warmup": "off",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        },
        "Stage final": {
            "training_stage": "Stage final",
            "task": "Coupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Phase E in Han's slides (full task: block = [20, 60, 20], p_sum = 0.45, p_ratio = [8:1], [6:1], [3:1], [1:1])",
            "BaseRewardSum": 0.45,
            "RewardFamily": 1,
            "RewardPairsN": 4,
            "UncoupledReward": "",
            "Randomness": "Exponential",
            "BlockMin": 20,
            "BlockMax": 60,
            "BlockBeta": 20,
            "BlockMinReward": 0,
            "DelayMin": 1.0,
            "DelayMax": 1.0,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": false,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 10,
            "Ignored": 10,
            "ITIMin": 1.0,
            "ITIMax": 30.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 1.0,
            "RewardConsumeTime": 3.0,
            "StopIgnores": 25,
            "AdvancedBlockAuto": "off",
            "SwitchThr": 0.6,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 75,
            "RightValue_volume": 2.0,
            "LeftValue_volume": 2.0,
            "warmup": "off",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        },
        "Graduated": {
            "training_stage": "Stage final",
            "task": "Coupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Phase E in Han's slides (full task: block = [20, 60, 20], p_sum = 0.45, p_ratio = [8:1], [6:1], [3:1], [1:1])",
            "BaseRewardSum": 0.45,
            "RewardFamily": 1,
            "RewardPairsN": 4,
            "UncoupledReward": "",
            "Randomness": "Exponential",
            "BlockMin": 20,
            "BlockMax": 60,
            "BlockBeta": 20,
            "BlockMinReward": 0,
            "DelayMin": 1.0,
            "DelayMax": 1.0,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": false,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 10,
            "Ignored": 10,
            "ITIMin": 1.0,
            "ITIMax": 30.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 1.0,
            "RewardConsumeTime": 3.0,
            "StopIgnores": 25,
            "AdvancedBlockAuto": "off",
            "SwitchThr": 0.6,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 75,
            "RightValue_volume": 2.0,
            "LeftValue_volume": 2.0,
            "warmup": "off",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        }
    },
    "curriculum": {
        "Stage 1 w/warmup": {
            "from_stage": "Stage 1 w/warmup",
            "transition_rules": [
                {
                    "decision": "progress",
                    "to_stage": "Stage 2",
                    "condition": "lambda metrics:\n                        metrics.finished_trials[-1] >= 200\n                        and\n                        metrics.foraging_efficiency[-1] >= 0.6\n                        ",
                    "condition_description": "Finished trials >= 200 and efficiency >= 0.6"
                },
                {
                    "decision": "progress",
                    "to_stage": "Stage 1",
                    "condition": "lambda metrics:\n                        metrics.session_at_current_stage >= 1\n                        ",
                    "condition_description": "After the first session"
                }
            ]
        },
        "Stage 1": {
            "from_stage": "Stage 1",
            "transition_rules": [
                {
                    "decision": "progress",
                    "to_stage": "Stage 2",
                    "condition": "lambda metrics:\n                        metrics.finished_trials[-1] >= 200\n                        and\n                        metrics.foraging_efficiency[-1] >= 0.6\n                        ",
                    "condition_description": "Finished trials >= 200 and efficiency >= 0.6"
                }
            ]
        },
        "Stage 2": {
            "from_stage": "Stage 2",
            "transition_rules": [
                {
                    "decision": "progress",
                    "to_stage": "Stage 3",
                    "condition": "lambda metrics:\n                        metrics.finished_trials[-1] >= 300\n                        and\n                        metrics.foraging_efficiency[-1] >= 0.65\n                        ",
                    "condition_description": "Finished trials >= 300 and efficiency >= 0.65"
                },
                {
                    "decision": "rollback",
                    "to_stage": "Stage 1",
                    "condition": "lambda metrics:\n                        metrics.finished_trials[-1] < 200\n                        or\n                        metrics.foraging_efficiency[-1] < 0.55\n                        ",
                    "condition_description": "Finished trials < 200 or efficiency < 0.55"
                }
            ]
        },
        "Stage 3": {
            "from_stage": "Stage 3",
            "transition_rules": [
                {
                    "decision": "progress",
                    "to_stage": "Stage final",
                    "condition": "lambda metrics:\n                        metrics.finished_trials[-1] >= 400\n                        and\n                        metrics.foraging_efficiency[-1] >= 0.7\n                        ",
                    "condition_description": "Finished trials >= 400 and efficiency >= 0.7"
                },
                {
                    "decision": "rollback",
                    "to_stage": "Stage 2",
                    "condition": "lambda metrics:\n                        metrics.finished_trials[-1] < 300\n                        or\n                        metrics.foraging_efficiency[-1] < 0.65\n                        ",
                    "condition_description": "Finished trials < 300 or efficiency < 0.65"
                }
            ]
        },
        "Stage final": {
            "from_stage": "Stage final",
            "transition_rules": [
                {
                    "decision": "progress",
                    "to_stage": "Graduated",
                    "condition": "lambda metrics:\n                        metrics.session_total >= 10 \n                        and\n                        metrics.session_at_current_stage >= 5\n                        and\n                        np.mean(metrics.finished_trials[-5:]) >= 450\n                        and\n                        np.mean(metrics.foraging_efficiency[-5:]) >= 0.70\n                        ",
                    "condition_description": "For recent 5 sessions,mean finished trials >= 450 and mean efficiency >= 0.70 and total sessions >= 10 and sessions at final >= 5"
                },
                {
                    "decision": "rollback",
                    "to_stage": "Stage 3",
                    "condition": "lambda metrics:\n                        np.mean(metrics.finished_trials[-5:]) < 300\n                        or\n                        np.mean(metrics.foraging_efficiency[-5:]) < 0.60\n                        ",
                    "condition_description": "For recent 5 sessions, mean finished trials < 300 or efficiency < 0.60"
                }
            ]
        }
    }
}